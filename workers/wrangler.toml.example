name = "gmail-wa-processor"
main = "src/index.ts"
compatibility_date = "2024-09-23"
compatibility_flags = ["nodejs_compat"]

# Cron trigger - every 5 minutes
[triggers]
crons = ["*/5 * * * *"]

# D1 Database - create with: npx wrangler d1 create gmail-wa-transactions
# Or use an existing database
[[d1_databases]]
binding = "DB"
database_name = "your-database-name"
database_id = "your-database-id"

# KV Namespaces - create with:
# npx wrangler kv namespace create OAUTH_TOKENS
# npx wrangler kv namespace create CREDENTIALS
[[kv_namespaces]]
binding = "OAUTH_TOKENS"
id = "your-oauth-tokens-namespace-id"

[[kv_namespaces]]
binding = "CREDENTIALS"
id = "your-credentials-namespace-id"

# Non-sensitive environment variables
[vars]
GMAIL_ACCOUNTS = "account1,account2"
GMAIL_SEARCH_QUERY = "subject:(Transfer OR Pembayaran OR Transaksi OR payment OR transaction) is:unread newer_than:1d"
GEMINI_MODEL = "gemini-flash-latest"
BATCH_NOTIFICATION_THRESHOLD = "5"
WAHA_SESSION_NAME = "default"
ENABLE_WHATSAPP_NOTIFICATIONS = "true"
WHATSAPP_PHONE_NUMBERS = "your-phone-number"
WHATSAPP_GROUP_ID = "your-group-id@g.us"

# Observability
[observability]
enabled = true

# Limits (paid plan)
# [limits]
# cpu_ms = 30000

# =============================================================================
# SETUP INSTRUCTIONS
# =============================================================================
# 1. Copy this file to wrangler.toml
#    cp wrangler.toml.example wrangler.toml
#
# 2. Create KV namespaces and update IDs:
#    npx wrangler kv namespace create OAUTH_TOKENS
#    npx wrangler kv namespace create CREDENTIALS
#
# 3. Create or reference D1 database and update ID
#
# 4. Update [vars] with your configuration
#
# 5. Set secrets:
#    npx wrangler secret put GEMINI_API_KEY
#    npx wrangler secret put WAHA_BASE_URL
#    npx wrangler secret put WAHA_API_KEY
#
# 6. Deploy:
#    npx wrangler deploy
# =============================================================================
